{% extends "base.html" %}
{% block title %}Fase 2: Dosificación y Alimentación{% endblock %}
{% block content %}
<h1 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 0.25rem;">Fase 2: Dosificación y Alimentación</h1>
<p class="subtitle" style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 1.5rem;">Balance de masa. La cal viva se dosifica de forma controlada hacia el slaker mediante tornillo sinfín y pesómetro.</p>

<div class="card">
    <h2>Pesómetro — Caudal másico (Ton/h)</h2>
    <p style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 0.5rem;">2280-WI-01769. Balance de masa hacia el slaker.</p>
    <div class="chart-container">
        <canvas id="chartPhase2"></canvas>
    </div>
</div>
<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 1rem;">
    <div class="card">
        <h3>Estado del Tornillo Alimentador</h3>
        <p style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 0.5rem;">Indicador de marcha/parada del tornillo dosificador. Tag: 2270-SAL-11817.</p>
        <p class="data-value" style="font-size: 1rem;">—</p>
    </div>
</div>
{% endblock %}
{% block extra_js %}
<script>
(function() {
    var ctx = document.getElementById('chartPhase2');
    if (!ctx) return;
    fetch('/api/data/2').then(function(r) { return r.json(); }).then(function(data) {
        var labels = data.timestamps || [];
        var vals = data['2280-WI-01769'] || [];
        if (!vals.length) return;
        var chartOpts = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { labels: { color: '#8b949e', font: { family: 'JetBrains Mono' } } } },
            scales: {
                x: { grid: { color: 'rgba(48,54,61,0.5)' }, ticks: { color: '#8b949e', font: { family: 'JetBrains Mono' }, maxTicksLimit: 10 } },
                y: { grid: { color: 'rgba(48,54,61,0.5)' }, ticks: { color: '#8b949e', font: { family: 'JetBrains Mono' } } }
            }
        };
        new Chart(ctx, {
            type: 'line',
            data: { labels: labels, datasets: [{ label: 'Pesómetro Ton/h (2280-WI-01769)', data: vals, borderColor: '#00ff88', backgroundColor: 'transparent', fill: false, tension: 0.3 }] },
            options: chartOpts
        });
    });
})();
</script>
{% endblock %}
