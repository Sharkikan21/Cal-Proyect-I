{% extends "base.html" %}
{% block title %}Fase 3: Hidratación (Apagado){% endblock %}
{% block extra_css %}
<style>
.chart-container-phase3 { position: relative; width: 100%; height: 380px; margin-top: 0.5rem; }
@media (min-width: 768px) { .chart-container-phase3 { height: 420px; } }
.chart-container-phase3 canvas { max-height: 100%; }
</style>
{% endblock %}
{% block content %}
<h1 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 0.25rem;">Fase 3: Hidratación (Apagado)</h1>
<p class="subtitle" style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 1.5rem;">Reactividad y exotermicidad (concepto clave según Coloma). CaO + H₂O → Ca(OH)₂. La curva de temperatura permite distinguir cal reactiva de cal &quot;muerta&quot; o sobrecocida.</p>

<div class="card" style="border-color: var(--accent-amber);">
    <h2 style="color: var(--accent-amber);">Curva de Temperatura de Apagado y Zona de Reactividad Óptima</h2>
    <p style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 0.5rem;">2270-TT-11824B (temperatura slaker) y 2270-FIT-11801 (flujo agua). Zona óptima 70–90°C según Coloma.</p>
    <div class="chart-container-phase3">
        <canvas id="chartPhase3"></canvas>
    </div>
</div>
{% endblock %}
{% block extra_js %}
<script>
(function() {
    var ctx = document.getElementById('chartPhase3');
    if (!ctx) return;
    fetch('/api/data/3').then(function(r) { return r.json(); }).then(function(data) {
        var labels = data.timestamps || [];
        var temps = data['2270-TT-11824B'] || [];
        var flow = data['2270-FIT-11801'] || [];
        var n = Math.max(labels.length, 1);
        var zone70 = Array(n).fill(70);
        var zone90 = Array(n).fill(90);
        var datasets = [
            { label: 'Zona óptima 70°C', data: zone70, borderColor: 'rgba(0,255,136,0.45)', borderDash: [4,4], pointRadius: 0, fill: false, order: 0 },
            { label: 'Zona óptima 90°C (Coloma)', data: zone90, borderColor: 'rgba(0,255,136,0.45)', borderDash: [4,4], pointRadius: 0, fill: '-1', backgroundColor: 'rgba(0,255,136,0.12)', order: 0 }
        ];
        if (temps.length) datasets.push({ label: 'Temperatura Slaker °C (2270-TT-11824B)', data: temps, borderColor: '#ff9500', borderWidth: 2.5, backgroundColor: 'transparent', fill: false, tension: 0.3, order: 1 });
        if (flow.length) datasets.push({ label: 'Flujo Agua (2270-FIT-11801)', data: flow, borderColor: '#00ff88', backgroundColor: 'transparent', fill: false, tension: 0.3, order: 2 });
        new Chart(ctx, {
            type: 'line',
            data: { labels: labels, datasets: datasets },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: { mode: 'index', intersect: false },
                plugins: {
                    legend: { labels: { color: '#8b949e', font: { family: 'JetBrains Mono' } } },
                    tooltip: { titleFont: { family: 'JetBrains Mono' }, bodyFont: { family: 'JetBrains Mono' } }
                },
                scales: {
                    x: { grid: { color: 'rgba(48,54,61,0.5)' }, ticks: { color: '#8b949e', font: { family: 'JetBrains Mono' }, maxTicksLimit: 12 } },
                    y: { grid: { color: 'rgba(48,54,61,0.5)' }, ticks: { color: '#8b949e', font: { family: 'JetBrains Mono' } } }
                }
            }
        });
    });
})();
</script>
{% endblock %}
